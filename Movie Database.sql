CREATE DATABASE MOVIE;
USE MOVIE;

CREATE TABLE ACTOR
(
    ACT_ID VARCHAR(10) PRIMARY KEY,
    ACT_NAME VARCHAR(20),
    ACT_GENDER VARCHAR(6)
);

DESC ACTOR;

CREATE TABLE DIRECTOR
(
    DIR_ID VARCHAR(10) PRIMARY KEY,
    DIR_NAME VARCHAR(20),
    DIR_PHONE VARCHAR(10)
);

DESC DIRECTOR;

CREATE TABLE MOVIES
(
    MOV_ID VARCHAR(10) PRIMARY KEY,
    MOV_TITLE VARCHAR(20) NOT NULL,
    MOV_YEAR VARCHAR(4),
    MOV_LANG VARCHAR(10),
    DIR_ID VARCHAR(10),
    FOREIGN KEY(DIR_ID) REFERENCES DIRECTOR(DIR_ID)
);

DESC MOVIES;

CREATE TABLE MOVIE_CAST
(
    ACT_ID VARCHAR(10),
    MOV_ID VARCHAR(10),
    ROLE VARCHAR(10),
    PRIMARY KEY(ACT_ID,MOV_ID),
    FOREIGN KEY(ACT_ID) REFERENCES ACTOR(ACT_ID),
    FOREIGN KEY(MOV_ID) REFERENCES MOVIES(MOV_ID)
);

DESC MOVIE_CAST;

CREATE TABLE RATING
(
    MOV_ID VARCHAR(10) PRIMARY KEY,
    REV_STARS VARCHAR(2)
);

DESC RATING;

INSERT INTO ACTOR VALUES("100","HEDY LEMARR","FEMALE");
INSERT INTO ACTOR VALUES("101","JOHN","MALE");
INSERT INTO ACTOR VALUES("102","SHAH","MALE");
INSERT INTO ACTOR VALUES("103","ALIA BHATT","FEMALE");
INSERT INTO ACTOR VALUES("104","KAREENA","FEMALE");

SELECT * FROM ACTOR;

INSERT INTO DIRECTOR VALUES("500","STEVEN SPIELBERG","1234567899");
INSERT INTO DIRECTOR VALUES("501","HITCHCOCK","9934567899");
INSERT INTO DIRECTOR VALUES("502","JAMES CAMERON","8894567899");
INSERT INTO DIRECTOR VALUES("503","MARTIN SCORSESE","1234566899");
INSERT INTO DIRECTOR VALUES("504","QUENTIN TARANTINO","8934567899");

SELECT * FROM DIRECTOR;


INSERT INTO MOVIES VALUES("1000","THE POST","2017","ENGLISH","500");
INSERT INTO MOVIES VALUES("1001","WEST SIDE STORY","2021","ENGLISH","500");
INSERT INTO MOVIES VALUES("1002","LINCOLN","2012","ENGLISH","500");
INSERT INTO MOVIES VALUES("1003","PSYCHO","1960","ENGLISH","501");
INSERT INTO MOVIES VALUES("1004","AVATAR","2009","ENGLISH","502");
INSERT INTO MOVIES VALUES("1005","TITANIC","1997","ENGLISH","502");
INSERT INTO MOVIES VALUES("1006","THE AVIATOR","2004","ENGLISH","503");
INSERT INTO MOVIES VALUES("1007","DEATH PROOF","2007","ENGLISH","504");

SELECT * FROM MOVIES;

INSERT INTO MOVIE_CAST VALUES("100","1000","MAIN");
INSERT INTO MOVIE_CAST VALUES("100","1001","ANTAGONIST");
INSERT INTO MOVIE_CAST VALUES("101","1003","ANTAGONIST");
INSERT INTO MOVIE_CAST VALUES("101","1002","ANTAGONIST");
INSERT INTO MOVIE_CAST VALUES("102","1005","COMEDIAN");
INSERT INTO MOVIE_CAST VALUES("103","1007","ANTAGONIST");
INSERT INTO MOVIE_CAST VALUES("104","1006","MAIN");

SELECT * FROM MOVIE_CAST;

INSERT INTO RATING VALUES("1001","5");
INSERT INTO RATING VALUES("1002","9");
INSERT INTO RATING VALUES("1003","4");
INSERT INTO RATING VALUES("1004","7");
INSERT INTO RATING VALUES("1005","10");
INSERT INTO RATING VALUES("1006","9");
INSERT INTO RATING VALUES("1007","7");
INSERT INTO RATING VALUES("1000","5");

SELECT * FROM RATING;

SELECT M.MOV_TITLE FROM MOVIES M,DIRECTOR D WHERE D.DIR_ID=M.DIR_ID AND D.DIR_NAME="HITCHCOCK";

SELECT MOV_TITLE FROM MOVIES M,MOVIE_CAST MC WHERE M.MOV_ID=MC.MOV_ID AND MC.ACT_ID IN (SELECT A.ACT_ID FROM MOVIE_CAST A GROUP BY(A.ACT_ID) HAVING COUNT(A.ACT_ID)>1) GROUP BY MOV_TITLE;

(SELECT A.ACT_NAME FROM ACTOR A JOIN MOVIE_CAST MC ON A.ACT_ID=MC.ACT_ID JOIN MOVIES M ON MC.MOV_ID=M.MOV_ID WHERE M.MOV_YEAR>"2000")
INTERSECT
(SELECT A.ACT_NAME FROM ACTOR A JOIN MOVIE_CAST MC ON A.ACT_ID=MC.ACT_ID JOIN MOVIES M ON MC.MOV_ID=M.MOV_ID WHERE M.MOV_YEAR<"1990");

SELECT MOV_TITLE,MAX(REV_STARS) FROM  MOVIES INNER JOIN RATING USING(MOV_ID) GROUP BY MOV_TITLE HAVING MAX(REV_STARS)>5 ORDER BY MOV_TITLE;

UPDATE RATING SET REV_STARS="5" WHERE MOV_ID IN (SELECT M.MOV_ID FROM MOVIES M,DIRECTOR D WHERE D.DIR_NAME="STEVEN SPIELBERG"  AND D.DIR_ID=M.DIR_ID);

SELECT * FROM RATING;




SELECT MOV_TITLE,MAX(REV_STARS) FROM MOVIES INNER JOIN RATING USING(MOV_ID) GROUP BY MOV_TITLE HAVING MAX(REV_STARS)>5 ORDER BY MOV_TITLE;






