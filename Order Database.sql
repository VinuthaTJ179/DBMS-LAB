CREATE DATABASE ORDERS;
USE ORDERS;

CREATE TABLE SALESMAN
(
    SALESMAN_ID VARCHAR(10) PRIMARY KEY,
    NAME VARCHAR(10),
    CITY VARCHAR(20),
    COMMISSION INT
);

DESC SALESMAN;

CREATE TABLE CUSTOMER 
(
    CUSTOMER_ID VARCHAR(10) PRIMARY KEY,
    CUSTOMER_NAME VARCHAR(10),
    CITY VARCHAR(20),
    GRADE INT,
    SALESMAN_ID VARCHAR(10),
    FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN(SALESMAN_ID) ON DELETE CASCADE
);

DESC CUSTOMER;

CREATE TABLE ORDERS
(
    ORDER_NO VARCHAR(10) PRIMARY KEY,
    PURCHASE_AMT INT,
    ORD_DATE DATE,
    SALESMAN_ID VARCHAR(10),
    CUSTOMER_ID VARCHAR(10),
    FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN(SALESMAN_ID) ON DELETE CASCADE,
    FOREIGN KEY(CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID) ON DELETE CASCADE
);

DESC ORDERS;

INSERT INTO SALESMAN VALUES("100","RAJESH","BANGALORE",1500);
INSERT INTO SALESMAN VALUES("101","SURESH","CHENNAI",900);
INSERT INTO SALESMAN VALUES("102","ATIF","HYDERABAD",700);
INSERT INTO SALESMAN VALUES("103","SHRAMA","INDORE",300);
INSERT INTO SALESMAN VALUES("104","RANJINI","DELHI",200);

SELECT * FROM SALESMAN;

INSERT INTO CUSTOMER VALUES("1000","ANJALI","BANGALORE",12,"100");
INSERT INTO CUSTOMER VALUES("1001","RITA","DELHI",12,"104");
INSERT INTO CUSTOMER VALUES("1002","RAJ","CHENNAI",79,"101");
INSERT INTO CUSTOMER VALUES("1003","PRATHAMA","BANGALORE",89,"100");
INSERT INTO CUSTOMER VALUES("1004","ALIA","MUMBAI",22,"103");
INSERT INTO CUSTOMER VALUES("1005","KRITI","INDORE",78,"103");
INSERT INTO CUSTOMER VALUES("1006","PRAJIN","HYDERABAD",49,"102");
INSERT INTO CUSTOMER VALUES("1007","DAVID","MUMBAI",17,"101");
INSERT INTO CUSTOMER VALUES("1008","PRIYA","DELHI",9,"103");
INSERT INTO CUSTOMER VALUES("1009","RAKSHA","INDORE",88,"101");

SELECT * FROM CUSTOMER;

INSERT INTO ORDERS VALUES("5000",150,"2022-01-01","100","1000");
INSERT INTO ORDERS VALUES("5001",250,"2022-02-01","101","1002");
INSERT INTO ORDERS VALUES("5002",350,"2022-03-01","102","1001");
INSERT INTO ORDERS VALUES("5003",450,"2022-04-01","102","1002");
INSERT INTO ORDERS VALUES("5004",550,"2022-05-01","103","1003");
INSERT INTO ORDERS VALUES("5005",900,"2022-06-01","104","1001");
INSERT INTO ORDERS VALUES("5006",1000,"2022-07-01","100","1002");
INSERT INTO ORDERS VALUES("5007",50000,"2022-02-01","102","1003");
INSERT INTO ORDERS VALUES("5008",9000,"2022-07-01","104","1001");
INSERT INTO ORDERS VALUES("5009",9990,"2022-04-01","101","1000");



SELECT * FROM ORDERS;

SELECT GRADE,COUNT(CUSTOMER_ID) FROM CUSTOMER GROUP BY(GRADE) HAVING GRADE > (SELECT AVG(GRADE) FROM CUSTOMER WHERE CITY="BANGALORE");

SELECT SALESMAN_ID,NAME FROM SALESMAN WHERE SALESMAN_ID IN (SELECT SALESMAN_ID FROM CUSTOMER GROUP BY(SALESMAN_ID) HAVING COUNT(SALESMAN_ID)>1);

(SELECT S.SALESMAN_ID,S.NAME,C.CUSTOMER_NAME,S.CITY FROM SALESMAN S,CUSTOMER C WHERE S.CITY=C.CITY AND S.SALESMAN_ID=C.SALESMAN_ID)
UNION
(SELECT S.SALESMAN_ID,S.NAME,C.CUSTOMER_NAME,"No match" FROM SALESMAN S,CUSTOMER C WHERE S.CITY<>C.CITY AND S.SALESMAN_ID=C.SALESMAN_ID);

CREATE VIEW HIGHEST AS SELECT S.SALESMAN_ID,S.NAME,O.ORD_DATE,O.PURCHASE_AMT FROM SALESMAN S, ORDERS O WHERE S.SALESMAN_ID=O.SALESMAN_ID AND O.PURCHASE_AMT IN (SELECT MAX(PURCHASE_AMT) FROM ORDERS GROUP BY ORD_DATE);

DELETE FROM SALESMAN WHERE SALESMAN_ID="102";