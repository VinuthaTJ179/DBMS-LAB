CREATE DATABASE COLLEGE;
USE COLLEGE;

CREATE TABLE STUDENT
(
    USN VARCHAR(10) PRIMARY KEY,
    SNAME VARCHAR(10),
    ADDRESS VARCHAR(10),
    PHONE_NO VARCHAR(10),
    GENDER VARCHAR(6)
);

DESC STUDENT;

CREATE TABLE SEMSEC
(
    SSID VARCHAR(10) PRIMARY KEY,
    SEM VARCHAR(2),
    SEC VARCHAR(2)
);

DESC SEMSEC;

CREATE TABLE CLASS
(
    USN VARCHAR(10),
    SSID VARCHAR(10),
    PRIMARY KEY(USN,SSID),
    FOREIGN KEY(USN) REFERENCES STUDENT(USN) ON DELETE CASCADE,
    FOREIGN KEY(SSID) REFERENCES SEMSEC(SSID) ON DELETE CASCADE
);

DESC CLASS;

CREATE TABLE COURSE
(
    SUBCODE VARCHAR(10) PRIMARY KEY,
    TITLE VARCHAR(10),
    SEM VARCHAR(2),
    CREDITS INT
);

DESC COURSE;

CREATE TABLE IAMARKS
(
    USN VARCHAR(10),
    SSID VARCHAR(10),
    SUBCODE VARCHAR(10),
    IA1 INT,
    IA2 INT,
    IA3 INT,
    FINAL_IA INT,
    PRIMARY KEY(USN,SSID,SUBCODE),
    FOREIGN KEY(USN) REFERENCES STUDENT(USN) ON DELETE CASCADE,
    FOREIGN KEY(SSID) REFERENCES SEMSEC(SSID) ON DELETE CASCADE,
    FOREIGN KEY(SUBCODE) REFERENCES COURSE(SUBCODE) ON DELETE CASCADE
);

DESC IAMARKS;

INSERT INTO STUDENT VALUES("100","AKRITI","BANGALORE","1234567899","FEMALE");
INSERT INTO STUDENT VALUES("101","PREET","BHOPAL","1239967899","MALE");
INSERT INTO STUDENT VALUES("102","TRISHA","CHENNAI","4449567899","FEMALE");
INSERT INTO STUDENT VALUES("103","ARJUN","KOTTAYAM","1234599899","MALE");
INSERT INTO STUDENT VALUES("104","ABHINAV","BANGALORE","1233367899","MALE");

SELECT * FROM STUDENT;

INSERT INTO SEMSEC VALUES("1000","3","A");
INSERT INTO SEMSEC VALUES("1001","3","B");
INSERT INTO SEMSEC VALUES("1002","3","C");
INSERT INTO SEMSEC VALUES("2000","4","A");
INSERT INTO SEMSEC VALUES("2001","4","B");
INSERT INTO SEMSEC VALUES("2002","4","C");
INSERT INTO SEMSEC VALUES("3000","5","A");
INSERT INTO SEMSEC VALUES("3001","5","B");
INSERT INTO SEMSEC VALUES("3002","5","C");

SELECT * FROM SEMSEC;

INSERT INTO CLASS VALUES("100","1000");
INSERT INTO CLASS VALUES("103","1000");
INSERT INTO CLASS VALUES("104","1000");
INSERT INTO CLASS VALUES("102","1001");
INSERT INTO CLASS VALUES("101","1002");

SELECT * FROM CLASS;

INSERT INTO COURSE VALUES("3DSA","Structures","3",4);
INSERT INTO COURSE VALUES("3ADE","Analog","3",3);
INSERT INTO COURSE VALUES("3MATH","Math","3",2);
INSERT INTO COURSE VALUES("3SE","Software","3",3);

SELECT * FROM COURSE;

INSERT INTO IAMARKS(USN,SSID,SUBCODE,IA1,IA2,IA3) VALUES("100","1000","3DSA",45,45,45);
INSERT INTO IAMARKS(USN,SSID,SUBCODE,IA1,IA2,IA3) VALUES("100","1000","3ADE",48,49,27);
INSERT INTO IAMARKS(USN,SSID,SUBCODE,IA1,IA2,IA3) VALUES("100","1000","3MATH",12,15,45);
INSERT INTO IAMARKS(USN,SSID,SUBCODE,IA1,IA2,IA3) VALUES("101","1002","3SE",28,35,45);
INSERT INTO IAMARKS(USN,SSID,SUBCODE,IA1,IA2,IA3) VALUES("101","1002","3DSA",38,25,50);
INSERT INTO IAMARKS(USN,SSID,SUBCODE,IA1,IA2,IA3) VALUES("101","1002","3MATH",34,35,25);
INSERT INTO IAMARKS(USN,SSID,SUBCODE,IA1,IA2,IA3) VALUES("102","1001","3DSA",23,35,15);
INSERT INTO IAMARKS(USN,SSID,SUBCODE,IA1,IA2,IA3) VALUES("102","1001","3MATH",19,25,35);
INSERT INTO IAMARKS(USN,SSID,SUBCODE,IA1,IA2,IA3) VALUES("103","1000","3SE",25,35,12);
INSERT INTO IAMARKS(USN,SSID,SUBCODE,IA1,IA2,IA3) VALUES("104","1000","3ADE",45,50,50);

SELECT * FROM IAMARKS;


SELECT S.USN,S.SNAME,S.ADDRESS,S.PHONE_NO,S.GENDER FROM STUDENT S,SEMSEC SC,CLASS C WHERE S.USN=C.USN AND SC.SSID=C.SSID AND SC.SEM="3" AND SC.SEC="C";

SELECT SC.SEM,SC.SEC,S.GENDER,COUNT(S.GENDER) AS "COUNT" FROM STUDENT S,SEMSEC SC,CLASS C WHERE S.USN=C.USN AND SC.SSID=C.SSID GROUP BY SEM,SEC,GENDER ORDER BY SEM;

CREATE VIEW TEST1 AS SELECT I.USN,I.SSID,I.SUBCODE,I.IA1 FROM STUDENT S, CLASS C,IAMARKS I WHERE S.USN=C.USN AND C.USN=I.USN AND S.USN="101";
SELECT * FROM TEST1;

UPDATE IAMARKS SET FINAL_IA=GREATEST(IA1+IA2,IA2+IA3,IA3+IA1)/2;

SELECT S.USN,S.SNAME,S.ADDRESS,S.PHONE_NO,S.GENDER,
(CASE WHEN I.FINAL_IA>45 AND FINAL_IA<=50 THEN "OUTSTANDING"
      WHEN I.FINAL_IA>40 AND FINAL_IA<=45 THEN "GOOD" 
      ELSE "AVERAGE" 
      END) AS CAT
FROM STUDENT S,SEMSEC SS,IAMARKS I,COURSE C WHERE S.USN=I.USN AND SS.SSID=I.SSID AND C.SUBCODE=I.SUBCODE AND C.SEM=3;